#!/bin/sh

# This is a script that crawls the fs looking for git repos, reminding you which ones
# have changes that potentially need to be committed. I would use spotlight but it does not index
# hidden files/folders.
set -e

IFS='
'
for repo in `find . -type d -name .git -print`; do
	(
		cd $repo/..
		stat=`git status --porcelain`
		if [[ "$stat" == "" ]]; then
			echo "[32m$repo[0m"
		else
			for line in $stat; do
				[[ ! $line =~ ^\?\? ]] && notallunk="1"
			done
			if [[ -z $notallunk ]]; then
				echo "[34m$repo[0m"
				git status --porcelain
				# echo "[1;34m<<<<[0m $repo [1;34m====[0m"
			else
				echo "    [31m$repo[0m"
				git status --porcelain | sed "s/^/    /" # indent
				# echo "    [1;31m<<<<[0m $repo [1;31m====[0m"
			fi
		fi
		echo ""
	)
done
