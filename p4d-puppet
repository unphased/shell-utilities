#!/bin/sh

# This script runs diff through tmux at the current directory, so that you can
# interactively scroll it. 
# and tmux is then used to issue commands to reload the diff.
set -e

[[ -f .tmp_p4_diff ]] && echo "found .tmp_p4_diff, exiting" && exit -1
# save the current git diff string to use for comparison
p4d > .tmp_p4_diff


function cleanup {
	kill $FSWATCHPID
	rm .tmp_git_diff
	tmux kill-session -t git-diff-puppet
}
trap cleanup EXIT
tmux new-session -d -s git-diff-puppet sh
# tmux send-keys -t git-diff-puppet "git diff" enter
git-diff-puppet-onchange
fswatch . ~/util/git-diff-puppet-onchange &
FSWATCHPID=$!
tmux attach -t git-diff-puppet
echo "tmux finished: puppet script exiting"
